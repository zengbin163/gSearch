<?xml version="1.0" encoding="UTF-8"?>
<dynamicSql>
	<nodeMapping>
		<id>1</id>
		<cron><!-- 构建索引定时任务的执行时间 -->
			* * 0/5 * * ?
		</cron>
		<field><!-- 时间戳，大于这个时间戳的数据才能被构建成索引，这里先暂时写死一个时间，合理的做法应该单独抽到服务器作为一个文件 -->
			2019-05-01
		</field>
		<sql><!-- 需要构建索引的sql语句 %s字符串类型，%d整数类型 -->
			SELECT
				t1.id id,
				t1.product_name productName,
				t2.id firstCategoryId,
				t2.`name` firstCategoryName,
				t3.id secondCategoryId,
				t3.`name` secondCategoryName,
				t4.id thirdCategoryId,
				t4.`name` thirdCategoryName,
				t5.`name` brandName,
				t1.color color,
				t1.sex sex,
				t1.season season,
				tt.storeNumber storeNumber
			FROM
				t_product t1
				LEFT JOIN t_category t2 ON t1.first_category_id = t2.id
				LEFT JOIN t_category t3 ON t2.id = t3.parent_id
				LEFT JOIN t_category t4 ON t3.id = t4.parent_id
				LEFT JOIN t_brand t5 ON t1.product_brand_id = t5.id
				LEFT JOIN (SELECT product_id, sum( store_number ) AS storeNumber FROM t_product_stock GROUP BY product_id ) tt ON t1.id = tt.product_id 
			WHERE
				t1.modify_time > %s 
		 </sql>
	</nodeMapping>
</dynamicSql>